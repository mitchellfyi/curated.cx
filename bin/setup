#!/usr/bin/env ruby
# Development setup script

puts "ğŸš€ Setting up development environment..."
puts "=" * 50

# Bundle install
puts "\nğŸ“¦ Installing gems..."
system("bundle install") or exit(1)

# Database setup
puts "\nğŸ—„ï¸  Setting up database..."
system("rails db:create db:migrate db:seed") or exit(1)

# Install yarn dependencies
puts "\nğŸ“¦ Installing JavaScript dependencies..."
system("yarn install") or exit(1)

# Build assets once (without watch mode)
puts "\nğŸ¨ Building assets..."
system("yarn build:once && yarn build:css:once") or exit(1)

# Set up Overcommit git hooks
puts "\nğŸ”§ Setting up git hooks (Overcommit)..."
if system("bundle exec overcommit --install")
  system("bundle exec overcommit --sign")
  puts "âœ… Git hooks installed - quality checks will run on commit/push"
else
  puts "âš ï¸  Could not install git hooks (non-fatal)"
end

# Run quality checks
puts "\nğŸ” Running quality checks..."
quality_passed = system("./bin/quality")

puts "\n" + "=" * 50
if quality_passed
  puts "âœ… Development setup complete! All quality checks passed."
else
  puts "âš ï¸  Development setup complete, but some quality checks failed."
  puts "   Review the output above and fix any issues."
end
puts "\nğŸ’¡ Next step: Run ./bin/dev to start the development server"
