<% content_for :title, @tenant&.title || t('app.tagline') %>

<div class="container mx-auto px-4 py-8">
  <% if @tenant %>
    <div class="mb-8">
      <h1 class="text-4xl font-bold text-gray-900 mb-4">
        <%= @tenant.title %>
      </h1>

      <% if @tenant.description.present? %>
        <p class="text-xl text-gray-600 leading-relaxed">
          <%= @tenant.description %>
        </p>
      <% end %>
    </div>

    <%# Personalized recommendations section for logged-in users %>
    <% if user_signed_in? && @personalized_content&.any? %>
      <section class="mb-12">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-semibold text-gray-900">
            <%= t('homepage.for_you') %>
          </h2>
        </div>

        <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
          <% @personalized_content.each do |item| %>
            <%= render 'feed/content_card', content_item: item %>
          <% end %>
        </div>
      </section>
    <% end %>

    <%# Content Items Feed %>
    <% if @content_items&.any? %>
      <section class="mb-12">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-semibold text-gray-900">
            <%= t('listings.index.latest_content') %>
          </h2>
          <%= link_to t('actions.view_arrow'), feed_index_path,
                      class: "text-blue-600 hover:text-blue-700 font-medium" %>
        </div>

        <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
          <% @content_items.each do |item| %>
            <%= render 'feed/content_card', content_item: item %>
          <% end %>
        </div>
      </section>
    <% end %>

    <%# Listings by Category %>
    <% if @categories_with_listings&.any? %>
      <section class="mb-12">
        <h2 class="text-2xl font-semibold text-gray-900 mb-6">
          <%= t('homepage.browse_by_category') %>
        </h2>

        <% @categories_with_listings.each do |category, listings| %>
          <div class="mb-8">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-medium text-gray-900">
                <%= category.name %>
              </h3>
              <%= link_to t('actions.view_all'), category_path(category),
                          class: "text-blue-600 hover:text-blue-700 text-sm font-medium" %>
            </div>

            <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
              <% listings.each do |listing| %>
                <%= render 'listings/listing_card', listing: listing %>
              <% end %>
            </div>
          </div>
        <% end %>
      </section>
    <% end %>

    <%# Newsletter CTA %>
    <section class="mb-12">
      <%= render 'shared/newsletter_cta' %>
    </section>

    <%# Empty state when no content %>
    <% if @content_items&.empty? && @categories_with_listings&.empty? %>
      <div class="text-center py-12">
        <div class="text-gray-500">
          <p class="text-lg"><%= t('feed.empty.title') %></p>
          <p class="mt-2"><%= t('feed.empty.description') %></p>
        </div>
      </div>
    <% end %>
  <% else %>
    <div class="text-center py-12">
      <div class="text-gray-500">
        <p class="text-lg"><%= t('tenants.show.not_found.title') %></p>
        <p class="mt-2"><%= t('tenants.show.not_found.description') %></p>
      </div>
    </div>
  <% end %>
</div>
